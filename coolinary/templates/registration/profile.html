{% extends 'home/header.html' %}
{% load static %}
{% load hide_email %}
{% block inhead %}
    <style>
        .left-part {
            text-align: right;
            width: 150px;
            float: left;
            font-size: 14px;
            padding-right: 10px;
            padding-top: 10px;
        }

        .hide {
            display: none;
        }

        .right-part {
            width: 350px;
            float: left;
        }

        a {
            padding-left: 10px;
        }
    </style>
{% endblock %}

{% block title %}
    Личный кабинет
{% endblock %}

{% block body_block %}


    <div class="container">
        <h1 class="text-center">Личный кабинет</h1>
        <div class="row">
            <div class="col col-md-3 offset-md-1">
                <div class="user-block">
                    <div class="avatar-box">
                        <div class="edit-btn" onclick="goTo('/my_photo')" title="Изменить"></div>
                        <div class="del-btn" onclick="delAvatar()" title="Удалить"></div>
                        <div style="height:220px;width:220px;" class="mx-auto">
                            {% if profile.avatar %}
                                <img src="{{ profile.avatar.url }}" class="avatar" alt="avatar">
                            {% else %}
                                <img src="{% static 'default_avatar.png' %}" class="avatar" alt="default avatar">
                            {% endif %}
                        </div>
                    </div>
                    <hr>
                    <div class="photo-settings-block">
                        <div class="text-block">Формат загружаемого файла: JPEG или PNG</div>
                        <br>
                        <form method="post" enctype="multipart/form-data">
                            {% csrf_token %}
                            {{ form.as_p }}
                            <button type="submit">Загрузить</button>
                        </form>

                        <script type="text/javascript" src="/static/js/crop/jquery.imgareaselect.pack.js"></script>
                        <script src="/static/js/upload/jquery.ui.widget.min.js"></script>
                        <script src="/static/js/upload/jquery.iframe-transport.min.js"></script>
                        <script src="/static/js/upload/jquery.fileupload.min.js"></script>
                        <script src="/static/js/upload/script.min.js"></script>
                        <div class="photos-box hide">
                            <div class="big-photo-box" id="cropper"></div>

                        </div>
                        <div class="btn-pane">
                            <form id="crop_avatar">
                                <input type="hidden" name="crop_img" value="">
                                <input type="hidden" name="crop_orig" value="">
                                <input type="hidden" name="crop_ratio" value="">
                                <input type="hidden" name="crop_x1" value="">
                                <input type="hidden" name="crop_x2" value="">
                                <input type="hidden" name="crop_y1" value="">
                                <input type="hidden" name="crop_y2" value="">
                                <input type="hidden" name="crop_y2" value="">
                                <div class="btn btn-primary hide" id="submit_button">Сохранить</div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col col-md-auto">
                <div class="settings-pane vstack gap-2">
                    <div class="row mail_sett">
                        <div class="left-part">E-mail:</div>
                        <div class="right-part">
                            <input class="form-control inactive" type="text" name="mail"
                                   placeholder="{{ user.email|hide_email }}" value="" disabled="disabled"><a
                                href="javascript:{}" class="edit-link" onclick="changeEmail()">Изменить</a>
                        </div>
                    </div>
                    <div class="hor-spacer mail_sett"></div>
                    <div class="row mail_change visually-hidden">
                        <div class="left-part">Новый адрес:</div>
                        <div class="right-part">
                            <input class="form-control edit-link" type="text" name="new_mail" placeholder="" value=""><a
                                href="javascript:{}" onclick="changeEmail()">Отмена</a>
                        </div>
                    </div>
                    <div class="hor-spacer mail_change visually-hidden"></div>
                    <div class="row mail_change by_mail visually-hidden">
                        <div class="left-part">Старый адрес:</div>
                        <div class="right-part">
                            <input class="form-control edit-link" type="text" name="cur_mail" value="">
                            <a href="javascript:{}"
                               onclick="$('div.mail_change.by_mail').toggle();$('div.mail_change.by_pass').toggle();">Не
                                помню</a>
                        </div>
                    </div>
                    <div class="hor-spacer mail_change by_mail  visually-hidden"></div>
                    <div class="row mail_change by_pass visually-hidden">
                        <div class="left-part">Введите пароль:</div>
                        <div class="right-part">
                            <input class="form-control" type="password" name="cur_pass" value="">
                        </div>
                    </div>
                    <div class="hor-spacer mail_change by_pass visually-hidden"></div>
                    <div class="row pass_sett">
                        <div class="left-part">Пароль:</div>
                        <div class="right-part"><input class="form-control inactive" type="password" name="pass"
                                                       disabled="disabled" placeholder="******" value="">
                            <a href="javascript:{}" class="edit-link" onclick="changePassword()">Изменить</a></div>
                    </div>
                    <div class="hor-spacer pass_sett"></div>
                    <div class="row pass_change visually-hidden">
                        <div class="left-part">Новый пароль:</div>
                        <div class="right-part"><input class="form-control edit-link" type="password" name="new_pass"
                                                       value="">
                            <a href="javascript:{}" onclick="changePassword()">Отмена</a></div>
                    </div>
                    <div class="hor-spacer pass_change visually-hidden"></div>
                    <div class="row pass_change visually-hidden">
                        <div class="left-part">Повтор пароля:</div>
                        <div class="right-part"><input class="form-control" type="password" name="new_pass_check"
                                                       value=""></div>
                    </div>
                    <div class="hor-spacer pass_change visually-hidden"></div>
                    <div class="row pass_change visually-hidden">
                        <div class="left-part">Старый пароль:</div>
                        <div class="right-part"><input class="form-control edit-link" type="password" name="old_pass"
                                                       value="">
                            <a href="javascript:{}" onclick="goTo('/reminder')">Забыл?</a></div>
                    </div>
                    <div class="row pass_change visually-hidden">
                        <div class="left-part"></div>
                        <div class="right-part">
                            <div class="checkbox-box">
                                <br>
                                <input class="form-control" type="checkbox" id="global_logout" name="global_logout"
                                       value="1">
                                <label for="global_logout">Разлогинить на других устройствах</label>
                            </div>
                        </div>
                    </div>
                    <div class="hor-spacer pass_change visually-hidden"></div>
                    <div class="row">
                        <div class="left-part">Имя:</div>
                        <div class="right-part"><input class="form-control" type="text" name="first_name"
                                                       value="{{ user.first_name }}"></div>
                    </div>
                    <hr>
                    <div class="row">
                        <div class="left-part">Фамилия:</div>
                        <div class="right-part"><input class="form-control" type="text" name="last_name"
                                                       value="{{ user.last_name }}"></div>
                    </div>
                    <hr>
                    <div class="row">
                        <div class="left-part">Никнейм:</div>
                        <div class="right-part"><input class="form-control inactive" type="text" name="username"
                                                       disabled="disabled" value="{{ user.get_username }}"></div>
                    </div>
                    <hr>
                    <div class="row">
                        <div class="left-part">Дата рождения:</div>
                        <div class="right-part">
                            <script type="text/javascript">
                                const lf_config = {
                                    "months": [
                                        "январь",
                                        "февраль",
                                        "март",
                                        "апрель",
                                        "май",
                                        "июнь",
                                        "июль",
                                        "август",
                                        "сентябрь",
                                        "октябрь",
                                        "ноябрь",
                                        "декабрь"
                                    ],
                                    "abuse_comment": {
                                        "title": "Вы уверены?",
                                        "message": "",
                                        "button1": {
                                            "title": "Да"
                                        },
                                        "button2": {
                                            "title": "Нет"
                                        }
                                    },
                                    "unsubscribe_comment": {
                                        "title": "Отказаться от получения уведомлений о новых ответах в этой ветке комментариев?",
                                        "message": "",
                                        "button1": {
                                            "title": "Да"
                                        },
                                        "button2": {
                                            "title": "Нет"
                                        }
                                    },
                                    "delete_comment": {
                                        "title": "Вы уверены, что хотите удалить комментарий?",
                                        "message": "",
                                        "button1": {
                                            "title": "Да"
                                        },
                                        "button2": {
                                            "title": "Нет"
                                        }
                                    },
                                    "deleted_comment": "Комментарий удален",
                                    "unfollow_series": {
                                        "title": "Вы уверены, что хотите убрать сериал из избранных?",
                                        "message": "",
                                        "button1": {
                                            "title": "Да"
                                        },
                                        "button2": {
                                            "title": "Нет"
                                        }
                                    },
                                    "user_cant_send_pm": {
                                        "title": "Профиль не подтвержден",
                                        "message": "Данная функция доступна только для пользователей с подтвержденным e-mail",
                                        "button1": {
                                            "title": "Ок"
                                        }
                                    },
                                    "pm_block_user": {
                                        "title": "Вы уверены, что хотите заблокировать этого пользователя?",
                                        "message": "",
                                        "button1": {
                                            "title": "Да"
                                        },
                                        "button2": {
                                            "title": "Нет"
                                        }
                                    },
                                    "pm_unblock_user": {
                                        "title": "Вы уверены, что хотите разблокировать этого пользователя?",
                                        "message": "",
                                        "button1": {
                                            "title": "Да"
                                        },
                                        "button2": {
                                            "title": "Нет"
                                        }
                                    },
                                    "pm_delete_dialog": {
                                        "title": "Вы уверены, что хотите удалить всю переписку с этим пользователем?",
                                        "message": "Восстановление невозможно!",
                                        "button1": {
                                            "title": "Да"
                                        },
                                        "button2": {
                                            "title": "Нет"
                                        }
                                    },
                                    "pm": {
                                        "session": "Ошибка сессии. Перегрузите страницу и попробуйте заново.",
                                        "uid": "Ошибочный ID пользователя",
                                        "class": "Нельзя заблокировать пользователя этого класса",
                                        "too_short": "Сообщение слишком короткое",
                                        "guest": "E-mail пользователя не подтвержден. Сожалеем, но ему нельзя написать."
                                    },
                                    "user": {
                                        "default": "Возникла какая-то ошибка",
                                        "avatar_upload_4": "Неверный формат изображения",
                                        "avatar_upload_3": "Изображения слишком маленькое",
                                        "avatar_upload_2": "Ошибка загрузки изображения",
                                        "avatar_upload_1": "Только для залогиненных пользователей",
                                        "user_error": "Пользователь не найден. Возможно устарела сессия",
                                        "settings_password": "Пароль некорректен",
                                        "duplicate_mail": "Пользователь с таким E-mail уже зарегистрирован",
                                        "duplicate_username": "Пользователь с таким Никнеймом уже зарегистрирован",
                                        "mail_error": "Старый e-mail адрес введен неверно. E-mail не изменен",
                                        "mail_incorrect": "Новый e-mail адрес введен несколько некорректно.",
                                        "pass_error2": "Текущий пароль введен неверно. E-mail не изменен.",
                                        "pass_error": "Текущий пароль неверен. Пароль не изменен",
                                        "bdate_error": "Дата рождения указана неверно",
                                        "mail_change": "Повторный запрос. Завершите или отмените предыдущий",
                                        "resend_error": "Письмо было выслано недавно. Подождите немного.",
                                        "resend_code_activated": "Код использован. Профиль должен быть активен.",
                                        "resend_time": "Письмо уже отправлено, попробуйте через час.",
                                        "profile_enabled": "Не нужно ничего делать. Профиль уже активен.",
                                        "fname_too_long": "Длина имени не должна превышать 16 знаков",
                                        "lname_too_long": "Длина фамилии не должна превышать 24 знака",
                                        "forbidden_char": "Недопустимый символ в имени или фамилии",
                                        "login_error": "E-mail или пароль указан неверно",
                                        "captcha_error": "Код с картинки указан неверно"
                                    },
                                    "comments": {
                                        "empty": "Невозможно отправить пустой комментарий",
                                        "too_short": "Возможно, комментарий слишком короткий",
                                        "not_exists": "Попытка прокомментировать что-то несуществующее",
                                        "shutup": "Вы не можете писать комментарии",
                                        "email_not_confirmed": "Данная функция доступна только для пользователей с подтвержденным e-mail"
                                    },
                                    "vote": {
                                        "forbidden": "Только для зарегистрированных пользователей",
                                        "closed": "Голосование закрыто",
                                        "default": "Некорректные данные. Обновите страницу и попробуйте снова."
                                    },
                                    "default": "Произошла ошибка.",
                                    "required": "Не все обязательные поля заполнены.",
                                    "session": "Ошибка сессии. Перегрузите страницу и попробуйте заново.",
                                    "confirms": {
                                        "delete_avatar": {
                                            "title": "Вы уверены?",
                                            "message": "Вы действительно хотите удалить свой аватар?",
                                            "button1": {
                                                "title": "Да"
                                            },
                                            "button2": {
                                                "title": "Нет"
                                            }
                                        }
                                    },
                                    "monthNames": [
                                        "Январь",
                                        "Февраль",
                                        "Март",
                                        "Апрель",
                                        "Май",
                                        "Июнь",
                                        "Июль",
                                        "Август",
                                        "Сентябрь",
                                        "Октябрь",
                                        "Ноябрь",
                                        "Декабрь"
                                    ],
                                    "monthNames2": [
                                        "января",
                                        "февраля",
                                        "марта",
                                        "апреля",
                                        "мая",
                                        "июня",
                                        "июля",
                                        "августа",
                                        "сентября",
                                        "октября",
                                        "ноября",
                                        "декабря"
                                    ],
                                    "monthNamesShort": [
                                        "Янв",
                                        "Фев",
                                        "Мар",
                                        "Апр",
                                        "Май",
                                        "Июн",
                                        "Июл",
                                        "Авг",
                                        "Сен",
                                        "Окт",
                                        "Ноя",
                                        "Дек"
                                    ],
                                    "dayNames": [
                                        "воскресенье",
                                        "понедельник",
                                        "вторник",
                                        "среда",
                                        "четверг",
                                        "пятница",
                                        "суббота"
                                    ],
                                    "dayNamesShort": [
                                        "Вс",
                                        "Пн",
                                        "Вт",
                                        "Ср",
                                        "Чт",
                                        "Пт",
                                        "Сб"
                                    ]
                                }
                                let s_bday = 11;
                                let tmpl = '<select class="form-select d-inline " name="bday" rel="nosearch" style="width:fit-content;">';
                                tmpl += '<option value="0"> -- </option>';
                                for (let i = 1; i <= 31; ++i) {
                                    tmpl += '<option value="' + i + '"' + (i === s_bday ? 'selected="selected"' : '') + '>' + i + '</option>';
                                }
                                tmpl += '</select>';
                                document.write(tmpl);
                            </script>
                            {#                        <select name="bday" rel="nosearch" style="width:50px;" tabindex="-1" class="select2-hidden-accessible" aria-hidden="true"><option value="0"> -- </option><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option><option value="6">6</option><option value="7">7</option><option value="8">8</option><option value="9">9</option><option value="10">10</option><option value="11" selected="selected">11</option><option value="12">12</option><option value="13">13</option><option value="14">14</option><option value="15">15</option><option value="16">16</option><option value="17">17</option><option value="18">18</option><option value="19">19</option><option value="20">20</option><option value="21">21</option><option value="22">22</option><option value="23">23</option><option value="24">24</option><option value="25">25</option><option value="26">26</option><option value="27">27</option><option value="28">28</option><option value="29">29</option><option value="30">30</option><option value="31">31</option></select><span class="select2 select2-container select2-container--default" dir="ltr" style="width: 50px;"><span class="selection"><span class="select2-selection select2-selection--single" role="combobox" aria-haspopup="true" aria-expanded="false" tabindex="0" aria-labelledby="select2-bday-nw-container"><span class="select2-selection__rendered" id="select2-bday-nw-container" title="11">11</span><span class="select2-selection__arrow" role="presentation"><b role="presentation"></b></span></span></span><span class="dropdown-wrapper" aria-hidden="true"></span></span>#}
                            <script type="text/javascript">
                                let s_bmonth = 1;
                                tmpl = '<select class="form-select  d-inline" name="bmonth" rel="nosearch"  style="width:fit-content;">';
                                tmpl += '<option value="0"> -- </option>';
                                let t_month;
                                for (let i = 1; i <= 12; ++i) {
                                    t_month = lf_config.months[i - 1];
                                    t_month = t_month[0].toUpperCase() + t_month.slice(1);
                                    tmpl += '<option value="' + i + '"' + (i === s_bmonth ? 'selected="selected"' : '') + '>' + t_month + '</option>';
                                }
                                tmpl += '</select>';
                                document.write(tmpl);
                            </script>
                            {#                        <select name="bmonth" rel="nosearch" style="width:110px;" tabindex="-1" class="select2-hidden-accessible" aria-hidden="true"><option value="0"> -- </option><option value="1" selected="selected">Январь</option><option value="2">Февраль</option><option value="3">Март</option><option value="4">Апрель</option><option value="5">Май</option><option value="6">Июнь</option><option value="7">Июль</option><option value="8">Август</option><option value="9">Сентябрь</option><option value="10">Октябрь</option><option value="11">Ноябрь</option><option value="12">Декабрь</option></select>#}
                            {#                        <span class="select2 select2-container select2-container--default" dir="ltr" style="width: 110px;"><span class="selection"><span class="select2-selection select2-selection--single" role="combobox" aria-haspopup="true" aria-expanded="false" tabindex="0" aria-labelledby="select2-bmonth-ze-container"><span class="select2-selection__rendered" id="select2-bmonth-ze-container" title="Январь">Январь</span><span class="select2-selection__arrow" role="presentation"><b role="presentation"></b></span></span></span><span class="dropdown-wrapper" aria-hidden="true"></span></span>#}
                            <script type="text/javascript">
                                let s_byear = 1992;
                                tmpl = '<select class="form-select  d-inline" name="byear" rel="nosearch" style="width:fit-content;">';
                                tmpl += '<option value="0"> -- </option>';
                                const dateObj = new Date();
                                const year = dateObj.getFullYear();
                                for (let i = year - 13; i >= year - 100; --i) {
                                    tmpl += '<option value="' + i + '"' + (i === s_byear ? 'selected="selected"' : '') + '>' + i + '</option>';
                                }
                                tmpl += '</select>';
                                document.write(tmpl);
                            </script>
                            {#                        <select name="byear" rel="nosearch" style="width:70px;" tabindex="-1" class="select2-hidden-accessible" aria-hidden="true"><option value="0"> -- </option><option value="2010">2010</option><option value="2009">2009</option><option value="2008">2008</option><option value="2007">2007</option><option value="2006">2006</option><option value="2005">2005</option><option value="2004">2004</option><option value="2003">2003</option><option value="2002">2002</option><option value="2001">2001</option><option value="2000">2000</option><option value="1999">1999</option><option value="1998">1998</option><option value="1997">1997</option><option value="1996">1996</option><option value="1995">1995</option><option value="1994">1994</option><option value="1993">1993</option><option value="1992" selected="selected">1992</option><option value="1991">1991</option><option value="1990">1990</option><option value="1989">1989</option><option value="1988">1988</option><option value="1987">1987</option><option value="1986">1986</option><option value="1985">1985</option><option value="1984">1984</option><option value="1983">1983</option><option value="1982">1982</option><option value="1981">1981</option><option value="1980">1980</option><option value="1979">1979</option><option value="1978">1978</option><option value="1977">1977</option><option value="1976">1976</option><option value="1975">1975</option><option value="1974">1974</option><option value="1973">1973</option><option value="1972">1972</option><option value="1971">1971</option><option value="1970">1970</option><option value="1969">1969</option><option value="1968">1968</option><option value="1967">1967</option><option value="1966">1966</option><option value="1965">1965</option><option value="1964">1964</option><option value="1963">1963</option><option value="1962">1962</option><option value="1961">1961</option><option value="1960">1960</option><option value="1959">1959</option><option value="1958">1958</option><option value="1957">1957</option><option value="1956">1956</option><option value="1955">1955</option><option value="1954">1954</option><option value="1953">1953</option><option value="1952">1952</option><option value="1951">1951</option><option value="1950">1950</option><option value="1949">1949</option><option value="1948">1948</option><option value="1947">1947</option><option value="1946">1946</option><option value="1945">1945</option><option value="1944">1944</option><option value="1943">1943</option><option value="1942">1942</option><option value="1941">1941</option><option value="1940">1940</option><option value="1939">1939</option><option value="1938">1938</option><option value="1937">1937</option><option value="1936">1936</option><option value="1935">1935</option><option value="1934">1934</option><option value="1933">1933</option><option value="1932">1932</option><option value="1931">1931</option><option value="1930">1930</option><option value="1929">1929</option><option value="1928">1928</option><option value="1927">1927</option><option value="1926">1926</option><option value="1925">1925</option><option value="1924">1924</option><option value="1923">1923</option></select><span class="select2 select2-container select2-container--default" dir="ltr" style="width: 70px;"><span class="selection"><span class="select2-selection select2-selection--single" role="combobox" aria-haspopup="true" aria-expanded="false" tabindex="0" aria-labelledby="select2-byear-1y-container"><span class="select2-selection__rendered" id="select2-byear-1y-container" title="1992">1992</span><span class="select2-selection__arrow" role="presentation"><b role="presentation"></b></span></span></span><span class="dropdown-wrapper" aria-hidden="true"></span></span>#}
                        </div>
                    </div>
                    <hr>
                    <div class="row">
                        <div class="left-part">Пол:</div>
                        <div class="right-part">
                            <div class="left-block">
                                <div class="radio-box">
                                    <input type="radio" id="sex1" name="sex" value="1" checked="">
                                    <label for="sex1">Мужской</label>
                                </div>
                            </div>
                            <div class="right-block">
                                <div class="radio-box">
                                    <input type="radio" id="sex2" name="sex" value="2">
                                    <label for="sex2">Женский</label>
                                </div>
                            </div>
                        </div>
                    </div>
                    <hr>
                    <div class="row">
                        <div class="left-part">Страна:</div>
                        <div class="right-part">
                            {% include "registration/country-select.html" %}
                        </div>
                    </div>
                    <hr>
                    <div class="row">
                        <div class="left-part">Город:</div>
                        <div class="right-part">
                            {% include 'registration/sity-select.html' %}
                        </div>
                    </div>
                    <hr>
                    <div class="row">
                        <div class="left-part">Показывать:</div>
                        <div class="right-part">
                            <div class="left-block">
                                <div class="radio-box">
                                    <input type="radio" id="radio03" name="show_name" value="1">
                                    <label for="radio03">Имя и фамилию</label>
                                </div>
                            </div>
                            <div class="right-block">
                                <div class="radio-box">
                                    <input type="radio" id="radio04" name="show_name" value="0" checked="">
                                    <label for="radio04">Никнейм</label>
                                </div>
                            </div>
                        </div>
                    </div>
                    <hr>
                    <div class="row">
                        <div class="left-part">Мой ID:</div>
                        <div class="right-part"><input class="form-control inactive" type="text" name="myid"
                                                       disabled="disabled" value="{{ user.id }}"></div>
                    </div>
                    <hr>
                    <div class="row">
                        <div class="left-part"></div>
                        <div class="right-part">
                            <a class="btn btn-primary col-12" onclick="saveSettings()">Сохранить</a>
                        </div>
                    </div>
                </div>

            </div>

        </div>
    </div>

{% endblock %}